# Pino Log Format ‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ Fastify

## üìã ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö Pino Log Standard

### 1. **Basic Pino Log Structure:**
```json
{
  "level": 30,           // Log level (10=trace, 20=debug, 30=info, 40=warn, 50=error, 60=fatal)
  "time": 1754579912506, // Unix timestamp in milliseconds
  "pid": 7,              // Process ID
  "hostname": "0a42b2e0e58b", // Container/server hostname
  "msg": "request completed", // Log message
  "reqId": "req-1754579912502-iz2tbctwp", // Request ID (from Fastify)
  "res": {               // Response object
    "statusCode": 500
  },
  "responseTime": 4.327291999012232 // Response time in ms
}
```

## üéØ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Logs ‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏õ:

### 1. **Request Completed Log:**
```json
{
  "level": 30,
  "time": 1754579912506,
  "pid": 7,
  "hostname": "0a42b2e0e58b",
  "reqId": "req-1754579912502-iz2tbctwp",
  "res": {
    "statusCode": 500
  },
  "responseTime": 4.327291999012232,
  "msg": "request completed"
}
```

### 2. **Error Log:**
```json
{
  "level": 50,
  "time": 1754579912505,
  "pid": 7,
  "hostname": "0a42b2e0e58b",
  "error": "No telemetry data found in context...",
  "stack": "Error: No telemetry data found in context...",
  "requestId": "req-1754579912502-iz2tbctwp",
  "method": "POST",
  "url": "/api/users",
  "msg": "Unhandled error occurred"
}
```

### 3. **Telemetry/Trace Log (Custom Format):**
```javascript
{
  operationName: 'http_request_post__api_users',
  timestamp: '2025-08-07T15:18:32.503Z',
  operationDuration: 1,
  statusCode: 200,
  durationSeconds: '0.001',
  memoryUsageBytes: 15088,
  cpuTimeMs: '0.89'
}
```

## üìä Pino Log Levels:

| Level | Number | Description |
|-------|--------|-------------|
| `trace` | 10 | Very detailed debug info |
| `debug` | 20 | Debug information |
| `info` | 30 | General information |
| `warn` | 40 | Warning messages |
| `error` | 50 | Error messages |
| `fatal` | 60 | Fatal errors |

## üîß Fields ‡∏ó‡∏µ‡πà‡∏û‡∏ö‡πÉ‡∏ô Logs:

### Standard Pino Fields:
- `level`: Log level (number)
- `time`: Unix timestamp (milliseconds)
- `pid`: Process ID
- `hostname`: Server/container hostname
- `msg`: Log message

### Fastify-specific Fields:
- `reqId`: Request ID (generated by Fastify)
- `req`: Request object details
- `res`: Response object details
- `responseTime`: Response time in milliseconds

### Custom Application Fields:
- `requestId`: Custom request ID
- `method`: HTTP method
- `url`: Request URL
- `error`: Error message
- `stack`: Stack trace
- `traceId`: OpenTelemetry trace ID
- `spanId`: OpenTelemetry span ID

### Telemetry Fields:
- `operationName`: Operation/span name
- `timestamp`: ISO timestamp
- `operationDuration`: Duration in milliseconds
- `statusCode`: HTTP status code
- `durationSeconds`: Duration in seconds
- `memoryUsageBytes`: Memory usage
- `cpuTimeMs`: CPU time

## üé® Format Examples:

### 1. **Info Log:**
```bash
{"level":30,"time":1754579912506,"pid":7,"hostname":"0a42b2e0e58b","msg":"Server started"}
```

### 2. **Error with Stack:**
```bash
{"level":50,"time":1754579912505,"pid":7,"hostname":"0a42b2e0e58b","error":"No telemetry data found","stack":"Error: No telemetry...","msg":"Unhandled error occurred"}
```

### 3. **Request Log:**
```bash
{"level":30,"time":1754579912506,"pid":7,"hostname":"0a42b2e0e58b","reqId":"req-123","res":{"statusCode":200},"responseTime":4.32,"msg":"request completed"}
```

## üîç ‡∏Å‡∏≤‡∏£ Parse ‡πÉ‡∏ô Promtail:

### JSON Expressions ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Pino:
```yaml
pipeline_stages:
  - json:
      expressions:
        level: level          # Pino level (number)
        timestamp: time       # Unix timestamp
        message: msg          # Log message
        requestId: reqId      # Fastify request ID
        method: method        # HTTP method
        url: url             # Request URL
        statusCode: res.statusCode # Response status
        responseTime: responseTime # Response time
        error: error         # Error message
        stack: stack         # Stack trace
        pid: pid            # Process ID
        hostname: hostname   # Hostname
```

### Level Mapping:
```yaml
pipeline_stages:
  - json:
      expressions:
        pino_level: level
  - template:
      source: pino_level
      template: |
        {{ if eq . "10" }}trace{{ else if eq . "20" }}debug{{ else if eq . "30" }}info{{ else if eq . "40" }}warn{{ else if eq . "50" }}error{{ else if eq . "60" }}fatal{{ else }}unknown{{ end }}
      target: level_name
```

## üöÄ LogQL Queries ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Pino:

### 1. **‡∏´‡∏≤ Error Logs:**
```logql
{job="docker-direct"} | json | level="50"
```

### 2. **‡∏´‡∏≤ Request ‡∏ó‡∏µ‡πà‡∏ä‡πâ‡∏≤:**
```logql
{job="docker-direct"} | json | responseTime > 1000
```

### 3. **‡∏´‡∏≤ Logs ‡∏î‡πâ‡∏ß‡∏¢ Request ID:**
```logql
{job="docker-direct"} | json | reqId="req-1754579912502-iz2tbctwp"
```

### 4. **‡∏´‡∏≤ Logs ‡∏ï‡∏≤‡∏° HTTP Method:**
```logql
{job="docker-direct"} | json | method="POST"
```

## ‡∏™‡∏£‡∏∏‡∏õ:

**Pino log format ‡πÄ‡∏õ‡πá‡∏ô JSON structure ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏á‡∏ó‡∏µ‡πà:**
- ‡∏°‡∏µ standard fields: level, time, pid, hostname, msg
- ‡∏°‡∏µ Fastify-specific fields: reqId, req, res, responseTime  
- ‡∏°‡∏µ custom application fields: requestId, method, url, error
- ‡πÉ‡∏ä‡πâ numeric levels (30=info, 50=error)
- ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö structured logging ‡πÅ‡∏•‡∏∞ machine parsing

**‡∏á‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£ parse ‡πÉ‡∏ô Promtail ‡πÅ‡∏•‡∏∞ query ‡πÉ‡∏ô Grafana!** üìä
